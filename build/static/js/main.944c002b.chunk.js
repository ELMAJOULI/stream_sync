(this.webpackJsonpstream_sync=this.webpackJsonpstream_sync||[]).push([[0],{21:function(e,t,a){},33:function(e,t,a){e.exports=a(47)},38:function(e,t,a){},47:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),s=a(17),r=a.n(s),c=(a(38),a(22)),i=a(15),l=(a(21),a(8)),m=a(9),u=a(10),d=a(11),p=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return o.a.createElement("nav",{className:"navbar is-fixed-top",role:"navigation","aria-label":"main navigation"},o.a.createElement("div",{className:"navbar-brand"},o.a.createElement("div",{className:"navbar-item",href:"https://bulma.io"},o.a.createElement("img",{src:"/logo.png",width:"112",height:"28",alt:"Logo"}))),o.a.createElement("div",{id:"navbarBasicExample",className:"navbar-menu"},o.a.createElement("div",{className:"navbar-start"},o.a.createElement("div",{className:"navbar-item"},"Home"))),o.a.createElement("div",{className:"navbar-end"},o.a.createElement("div",{className:"navbar-item"},o.a.createElement("div",{className:"buttons"},o.a.createElement("div",{className:"button is-primary"},o.a.createElement("strong",null,"Buy me a coffee")),o.a.createElement("a",{href:"/host",target:"_blank",className:"button is-light"},"Host")))))}}]),a}(o.a.Component);var h=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(p,null),o.a.createElement("div",{className:"row"},o.a.createElement("a",{className:"select_column host",href:"/host"},"Host"),o.a.createElement("a",{className:"select_column join",href:"/join"},"Join")))},_=a(18);function b(e,t){localStorage.setItem(e,function(e){return btoa(JSON.stringify(e))}(t))}function v(e){var t=localStorage.getItem(e);return!!t&&function(e){return JSON.parse(atob(e))}(t)}function f(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=window.Peer,s={debug:2,host:"116.203.130.35",port:9e3,path:"/myapp",iceTransportPolicy:"relay",config:{iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:51.15.213.116:3478",username:"nishit",credential:"test123"}]}};if(n)var r=new o(n,s);else r=new o(s);if(window.peer_obj=r,window.is_host=t,!0!==t){var c=r.connect(a);E(c)}r.on("open",(function(t){console.log("MY peer ID is "+r.id),e.setState({peer_id:r.id}),!0===window.is_host&&e.setState({host_peer_id:r.id})})),r.on("connection",(function(e){console.log("connection called"),E(e)}))}function E(e){window.peer_ids.push(e.peer),e.on("data",(function(e){console.log("data received"),console.log(e),function(e){console.log("Data received: "),console.log(e),"object"===typeof e&&null!==e&&("chat"===e.data_type?N(e):"new_connection"===e.data_type?g(e.peer_id):"youtube"===e.data_type?function(e){""===window.global_this_obj.state.youtube_video_id&&window.global_this_obj.setState({youtube_video_id:e.videoId,youtube_current_pos:Math.ceil(e.startSeconds)})}(e):"intro"===e.data_type?function(e){var t=window.global_this_obj.state.connected_users;t[e.peer_id]={user_name:e.user_name,color_code:e.color_code},window.global_this_obj.setState({connected_users:t}),window.global_this_obj.notify("".concat(e.user_name," has joined the party")),function(e,t,a){var n=v(e);n[t]=a,b(e,n)}(window.peer_obj.id,"connected_users",t)}(e):"user_list"===e.data_type&&function(e){window.global_this_obj.setState({connected_users:e.user_list})}(e))}(e)})),console.log("Handled connection"),e.on("close",(function(){e=null})),window.connections.push(e),!0===window.is_host&&(setTimeout((function(){y(function(e){var t,a=window.yt_player;t=null!=e?e:a.getPlayerState();var n=a.getVideoData().video_id,o=a.getCurrentTime(),s=a.getPlaybackRate();return{data_type:"youtube",event:t,videoId:n,startSeconds:o,playbackRate:s}}()),y({data_type:"user_list",user_list:window.global_this_obj.state.connected_users})}),1500),function(e){for(var t={data_type:"new_connection",peer_id:e},a=0;a<window.connections.length;a++)window.connections[a].peer!==e&&window.connections[a].send(t)}(e.peer))}function y(e){console.log("Sending data: "),console.log(e);for(var t=window.connections,a=0;a<t.length;a++)t[a].send(e)}function g(e){E(window.peer_obj.connect(e))}function N(e){var t=window.global_this_obj.state.chat_log;e.message=decodeURIComponent(escape(window.atob(e.message))),t.push(e),window.global_this_obj.setState({chat_log:t})}function w(e,t,a,n){var o=function(e,t,a,n){return{data_type:"chat",user_name:t,user_type:a?"Host":"Client",message:btoa(unescape(encodeURIComponent(e))),color_code:n,time_stamp:Date.now()}}(e,t,a,n);y(o),N(o)}var j=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={user_name:"",room_name:"",youtube_video_id:"",host_peer_id:null,is_host:!0,submitted:!1},e.handleSubmit=function(t){t.preventDefault();var a=e.parseIdFromURL(t.target.youtubeLink.value);e.setState({user_name:t.target.userName.value,room_name:t.target.roomName.value,youtube_video_id:a,submitted:!0}),f(Object(_.a)(e),!0)},e.parseIdFromURL=function(e){var t=e.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return!(!t||11!==t[2].length)&&t[2]},e}return Object(m.a)(a,[{key:"render",value:function(){return console.log(this.state.host_peer_id),this.state.host_peer_id?(b(this.state.host_peer_id,this.state),o.a.createElement(i.a,{push:!0,to:{pathname:"party/"+this.state.host_peer_id,state:this.state}})):o.a.createElement(o.a.Fragment,null,o.a.createElement(p,null),o.a.createElement("section",{className:"section"},o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"columns is-centered"},o.a.createElement("div",{className:"column is-half"},o.a.createElement("div",{className:"card"},o.a.createElement("div",{className:"card-content"},o.a.createElement("form",{onSubmit:this.handleSubmit,className:"room_name"},o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},"RoomName"),o.a.createElement("div",{className:"control"},o.a.createElement("input",{className:"input",ref:this.roomNameRef,placeholder:"Type the name of your room",type:"text",name:"roomName",required:!0}))),o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},"Username"),o.a.createElement("div",{className:"control"},o.a.createElement("input",{className:"input",ref:this.hostUserName,placeholder:"Please enter your username",type:"text",name:"userName",required:!0}))),o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},"Youtube Link"),o.a.createElement("div",{className:"control"},o.a.createElement("input",{className:"input",ref:this.youtubeLinkRef,placeholder:"The Youtube link to be shared",type:"url",name:"youtubeLink",required:!0}))),o.a.createElement("div",{className:"buttons is-right"},o.a.createElement("button",{className:"button is-primary is-right"+(this.state.submitted?" is-loading":"")},"Party\ud83c\udf89"," "))))))))))}}]),a}(o.a.Component),S=(a(44),a(32)),O=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){return o.a.createElement("div",{className:"chat-bubble"},o.a.createElement("span",{className:"chat_user_name",style:{color:"#"+this.props.chat_data.color_code}},this.props.chat_data.user_name),this.props.chat_data.message)}}]),a}(o.a.Component),k=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={showEmojis:!1,message:""},n.showEmojis=function(e){n.setState({showEmojis:!0})},n.closeMenu=function(){n.setState({showEmojis:!1})},n.addEmoji=function(e){var t=e.native;n.setState({message:n.state.message+t}),n.closeMenu()},n.add_text=function(e){n.setState({message:e.target.value})},n.send_message=function(e){e.preventDefault(),""!==n.state.message&&(w(n.state.message,n.props.user_name,n.props.is_host,n.props.color_code),n.setState({message:""}))},n.chatBottom=o.a.createRef(),n}return Object(m.a)(a,[{key:"componentDidUpdate",value:function(){this.chatBottom.current.scrollIntoView({behavior:"smooth"})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"box"},o.a.createElement("div",{className:"box chat_box",onClick:this.closeMenu},this.props.chat_log.map((function(e,t){return o.a.createElement(O,{key:t,chat_data:e})})),o.a.createElement("span",{ref:this.chatBottom,id:"chat-bottom"})),o.a.createElement("form",{onSubmit:this.send_message},o.a.createElement("div",{className:"field is-grouped"},o.a.createElement("p",{className:""},this.state.showEmojis?o.a.createElement(o.a.Fragment,null,o.a.createElement(S.a,{onSelect:this.addEmoji,ref:function(t){return e.emojiPicker=t}}),o.a.createElement("button",{className:"button emoji-button"},o.a.createElement("span",{className:"icon is-small"},o.a.createElement("p",{onClick:this.closeMenu,className:"emoji"},"\u274c")))):o.a.createElement("button",{className:"button emoji-button"},o.a.createElement("span",{className:"icon is-small"},o.a.createElement("p",{onClick:this.showEmojis,className:"emoji"},String.fromCodePoint(128522))))),o.a.createElement("p",{className:"control is-expanded"},o.a.createElement("input",{className:"input",value:this.state.message,type:"text",placeholder:"Chat..",onChange:this.add_text})),o.a.createElement("p",{className:"control"},o.a.createElement("input",{className:"button is-info",type:"submit",value:"send"})))))}}]),a}(o.a.Component),C=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).loadScript=function(){if(window.YT)window.YT.Player&&n.loadVideo();else{var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",window.onYouTubeIframeAPIReady=n.loadVideo;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}},n.loadVideo=function(){n.state.player=new window.YT.Player("youtube-player-iframe",{videoId:n.props.youtube_video_id,playerVars:{autoplay:1,start:Math.ceil(n.props.youtube_current_pos)},events:{onReady:n.onPlayerReady,onStateChange:n.onPlayerStateChange,onPlaybackRateChange:n.onPlayerPlaybackRateChange}}),window.yt_player=n.state.player},n.onPlayerReady=function(e){e.target.playVideo()},n.onPlayerStateChange=function(e){console.log(e)},n.onPlaybackRateChange=function(e){console.log(e)},console.log(e),n.state={player:""},n}return Object(m.a)(a,[{key:"componentDidUpdate",value:function(){""===this.state.player&&""!==this.props.youtube_video_id&&this.loadScript()}},{key:"render",value:function(){return o.a.createElement("div",{className:"player_container"},o.a.createElement("div",{id:"youtube-player-iframe"}))}}]),a}(o.a.Component),x=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(m.a)(a,[{key:"render",value:function(){var e=this.props.connected_users;e||(e={});var t=[];for(var a in e){var n=e[a];t.push(o.a.createElement("div",{key:a,className:"avatar",title:n.user_name,style:{backgroundColor:"#"+n.color_code}},n.user_name[0]))}return o.a.createElement("div",{className:"box info_box"},o.a.createElement("h4",null,"Connected Users"),o.a.createElement("div",{className:"avatar_container"},t))}}]),a}(o.a.Component),R=a(27),P=(a(46),function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={user_name:"",room_name:"",youtube_video_id:"",youtube_current_pos:0,peer_id:"",is_host:!1,chat_log:[],invite_popup_shown:!1,connected_users:{},color_code:""},n.setUserName=function(e){e.preventDefault();var t=Math.floor(16777215*Math.random()).toString(16),a=n.state.connected_users;a[n.state.peer_id]={user_name:e.target.user_name.value,color_code:t,is_host:!1},n.setState({user_name:e.target.user_name.value,connected_users:a,color_code:t}),function(e,t){y({data_type:"intro",user_name:e,peer_id:window.peer_obj.id,color_code:t,time_stamp:Date.now()})}(e.target.user_name.value,t)},n.copyToClipboard=function(e){e.preventDefault(),n.copy_invite.select(),document.execCommand("copy"),n.setState({invite_popup_shown:!0})},n.closeModal=function(e){n.setState({invite_popup_shown:!0})},n.notify=function(e){R.b.info(e,{position:"bottom-left",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})},window.global_this_obj=Object(_.a)(n),window.peer_ids=[],window.connections=[],n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=v(this.props.match.params.host_id),t=Math.floor(16777215*Math.random()).toString(16);if(e){if(window.peer_obj||f(this,!0,null,this.props.match.params.host_id),e.connected_users){n=e.connected_users;var a=JSON.parse(JSON.stringify(n));delete a[this.props.match.params.host_id],function(e){var t=function(t){setTimeout((function(){g(e[t])}),500)};for(var a in e)t(a)}(Object.keys(a))}else{var n;(n={})[this.props.match.params.host_id]={user_name:e.user_name,color_code:t,is_host:!0}}this.setState({peer_id:this.props.match.params.host_id,user_name:e.user_name,youtube_video_id:e.youtube_video_id,room_name:e.room_name,is_host:e.is_host,connected_users:n,color_code:t})}else f(this,!1,this.props.match.params.host_id)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement(p,null),o.a.createElement(R.a,{position:"bottom-left",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0}),o.a.createElement("div",{className:"modal   "+(""===this.state.user_name?"is-active":"")},o.a.createElement("div",{className:"modal-background"}),o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"box"},o.a.createElement("form",{onSubmit:this.setUserName},o.a.createElement("div",{className:"field is-grouped"},o.a.createElement("p",{className:"control is-expanded"},o.a.createElement("input",{className:"input",type:"text",name:"user_name",placeholder:"Enter Your Username",required:!0})),o.a.createElement("p",{className:"control"},o.a.createElement("button",{className:"button is-primary is-light is-right"},"Party"," ",o.a.createElement("span",{role:"img","aria-label":"party_emoji"},"\ud83c\udf89"))))))),o.a.createElement("button",{className:"modal-close is-large","aria-label":"close"})),o.a.createElement("div",{className:"modal "+(!1===this.state.invite_popup_shown&&!0===this.state.is_host?"is-active":"")},o.a.createElement("div",{className:"modal-background",onClick:this.closeModal}),o.a.createElement("div",{className:"modal-content"},o.a.createElement("div",{className:"box"},o.a.createElement("form",{onSubmit:this.copyToClipboard},o.a.createElement("label",null,"Share the link with friends to stream together"),o.a.createElement("div",{className:"field is-grouped"},o.a.createElement("p",{className:"control is-expanded"},o.a.createElement("input",{className:"input",type:"text",value:window.location.href,name:"invite_link",readOnly:!0,ref:function(t){return e.copy_invite=t}})),o.a.createElement("p",{className:"control"},o.a.createElement("button",{className:"button is-primary is-light is-right"},"Copy to clipboard",o.a.createElement("span",{role:"img","aria-label":"cliboard_emoji"},"\ud83d\udccb"))))))),o.a.createElement("button",{className:"modal-close is-large","aria-label":"close",onClick:this.closeModal})),o.a.createElement("div",{className:"section"},o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"tile is-ancestor"},o.a.createElement("div",{className:"tile is-8 left_tile_custom"},o.a.createElement(C,{youtube_video_id:this.state.youtube_video_id,youtube_current_pos:this.state.youtube_current_pos}),o.a.createElement(x,{connected_users:this.state.connected_users})),o.a.createElement("div",{className:"tile"},o.a.createElement(k,{user_name:this.state.user_name,chat_log:this.state.chat_log,is_host:this.state.is_host,color_code:this.state.color_code}))))))}}]),a}(o.a.Component)),I=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={RoomId:""},e.handleSubmit=function(t){t.preventDefault(),e.setState({RoomId:t.target.RoomId.value})},e}return Object(m.a)(a,[{key:"render",value:function(){return""!==this.state.RoomId?o.a.createElement(i.a,{push:!0,to:{pathname:"party/"+this.state.RoomId,state:this.state}}):o.a.createElement(o.a.Fragment,null,o.a.createElement(p,null),o.a.createElement("section",{className:"section"},o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"columns is-centered"},o.a.createElement("div",{className:"column is-half"},o.a.createElement("div",{className:"card"},o.a.createElement("div",{className:"card-content"},o.a.createElement("form",{onSubmit:this.handleSubmit,className:"room_name"},o.a.createElement("div",{className:"field"},o.a.createElement("label",{className:"label"},"RoomId"),o.a.createElement("div",{className:"control"},o.a.createElement("input",{className:"input",ref:this.roomNameRef,placeholder:"Type the name of your room",type:"text",name:"RoomId",required:!0}))),o.a.createElement("div",{className:"buttons is-right"},o.a.createElement("button",{className:"button is-primary is-right"},"Party\ud83c\udf89"," "))))))))))}}]),a}(o.a.Component),M=function(){return o.a.createElement(c.a,null,o.a.createElement(i.d,null,o.a.createElement(i.b,{exact:!0,path:"/",component:h}),o.a.createElement(i.b,{exact:!0,path:"/host",component:j}),o.a.createElement(i.b,{exact:!0,path:"/join",component:I}),o.a.createElement(i.b,{exact:!0,path:"/party",component:j}),o.a.createElement(i.b,{exact:!0,path:"/party/:host_id",component:P})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[33,1,2]]]);
//# sourceMappingURL=main.944c002b.chunk.js.map